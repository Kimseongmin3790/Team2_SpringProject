<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.TeamProject.mapper.UserMapper">
	<insert id="insertUser" parameterType="hashmap">
		INSERT INTO USERS
		VALUES(#{userId}, #{userEmail}, #{hashPwd}, #{userName}, #{userPhone}, #{userRole}, #{userAddr}, SYSDATE, SYSDATE, 0)
	</insert>
	
	<insert id="insertSeller" parameterType="hashmap">
		INSERT INTO SELLER_INFO
		VALUES(#{userId}, #{farmName}, #{bizNo}, 'N', #{bizNo}, #{account}, #{bankName})
	</insert>
	
	<select id="idCheck" parameterType="hashmap" resultType="com.example.TeamProject.model.User">
		SELECT *
		FROM USERS
		WHERE USER_ID = #{userId}
	</select>
	
	<select id="loginUser" parameterType="hashmap" resultType="com.example.TeamProject.model.User">
		SELECT *
		FROM USERS
		WHERE USER_ID = #{userId}
	</select>
	
	<select id="findId" parameterType="hashmap" resultType="com.example.TeamProject.model.User">
		SELECT *
		FROM USERS
		WHERE NAME = #{userName} AND EMAIL = #{userEmail}
	</select>
	
	<select id="findPwd" parameterType="hashmap" resultType="com.example.TeamProject.model.User">
		SELECT *
		FROM USERS
		WHERE USER_ID = #{userId} AND NAME = #{userName} AND EMAIL = #{userEmail}
	</select>
	
	<update id="resetPwd" parameterType="hashmap">
		UPDATE USERS
		SET PASSWORD = #{hashPwd}
		WHERE USER_ID = #{userId}
	</update>
	
	<!-- 이메일로 사용자를 찾는 쿼리 -->
	<select id="findByEmail" parameterType="string" resultType="com.example.TeamProject.model.User">
	    SELECT *
	    FROM USERS
	    WHERE EMAIL = #{email}
	</select>

	<!-- 소셜 로그인 사용자를 저장하는 쿼리 -->
	<insert id="insertSocialUser" parameterType="com.example.TeamProject.model.User">
	    INSERT INTO USERS (
	        USER_ID,
	        EMAIL,
	        NAME,
	        USER_ROLE,
	        PASSWORD, <!-- 비밀번호는 null 또는 임의의 값으로 처리 -->
	        PHONE,    
	        ADDRESS, 
	        CDATETIME,
	        UDATETIME
	    ) VALUES (
	        #{userId},
	        #{email},
	        #{name},
	        #{userRole},
	        'social_user_password', <!-- 소셜 로그인 사용자는 비밀번호가 없으므로 임의의 값 지정 -->
	        NVL(#{phone, jdbcType=VARCHAR}, 'NONE'),
	        '소셜 로그인 사용자',    
	        SYSDATE,
	        SYSDATE
	    )
	</insert>
	
	<!-- 소셜 로그인 시 사용자 이름 등을 업데이트하는 쿼리 -->
	<update id="updateUser" parameterType="com.example.TeamProject.model.User">
	    UPDATE USERS
		<set>
		    NAME = #{name},
		    <if test="phone != null">
		        PHONE = #{phone, jdbcType=VARCHAR},
		    </if>
		    UDATETIME = SYSDATE
		</set>
		WHERE
   			EMAIL = #{email}
	</update>
	
</mapper>