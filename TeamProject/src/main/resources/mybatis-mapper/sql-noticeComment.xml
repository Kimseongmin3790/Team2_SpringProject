<?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

 <mapper namespace="com.example.TeamProject.mapper.NoticeCommentMapper">

     <!-- NoticeComment 모델과 DB 컬럼을 매핑합니다. -->
     <resultMap id="commentResultMap" type="com.example.TeamProject.model.NoticeComment">
         <id property="commentNo" column="COMMENT_NO"/>
         <result property="noticeNo" column="NOTICE_NO"/>
         <result property="userId" column="USER_ID"/>
         <result property="contents" column="CONTENTS"/>
         <result property="cdatetime" column="CDATETIME_FORMATTED"/>
         <result property="udatetime" column="UDATETIME_FORMATTED"/>
         <result property="parentCommentNo" column="PARENT_COMMENT_NO"/>
         <result property="level" column="LVL"/>
     </resultMap>

     <!-- 댓글 조회 -->
     <select id="findByNoticeNo" parameterType="int" resultMap="commentResultMap">
         SELECT
             COMMENT_NO,
             NOTICE_NO,
             USER_ID,
             CONTENTS,
             TO_CHAR(CDATETIME, 'YYYY-MM-DD HH24:MI') AS CDATETIME_FORMATTED,
             TO_CHAR(UDATETIME, 'YYYY-MM-DD HH24:MI') AS UDATETIME_FORMATTED,
             PARENT_COMMENT_NO,
             LEVEL AS LVL
         FROM
             NOTICE_COMMENT
         WHERE
             NOTICE_NO = #{noticeNo}
         START WITH
             PARENT_COMMENT_NO IS NULL
         CONNECT BY
             PRIOR COMMENT_NO = PARENT_COMMENT_NO
         ORDER SIBLINGS BY
             CDATETIME ASC
     </select>

     <!-- 댓글 작성 -->
     <insert id="save" parameterType="com.example.TeamProject.model.NoticeComment">
         <selectKey keyProperty="commentNo" resultType="int" order="BEFORE">
             SELECT NOTICE_COMMENT_SEQ.NEXTVAL FROM DUAL
         </selectKey>

         INSERT INTO NOTICE_COMMENT (
             COMMENT_NO,
             NOTICE_NO,
             USER_ID,
             CONTENTS,
             PARENT_COMMENT_NO,
             CDATETIME,
             UDATETIME
         ) VALUES (
             #{commentNo},
             #{noticeNo},
             #{userId},
             #{contents},
             #{parentCommentNo, jdbcType=NUMERIC},
             SYSDATE,
             SYSDATE
         )
     </insert>
     
     <!-- 댓글 수정 -->
	<update id="update" parameterType="com.example.TeamProject.model.NoticeComment">
	    UPDATE NOTICE_COMMENT
	       SET CONTENTS = #{contents},
	           UDATETIME = SYSDATE
	     WHERE COMMENT_NO = #{commentNo}
	</update>
	
	<!-- 댓글 삭제 -->
	<delete id="delete" parameterType="int">
	    DELETE FROM NOTICE_COMMENT
	     WHERE COMMENT_NO = #{commentNo}
	</delete>
	
	<!-- 댓글 조회 -->
	<select id="findById" parameterType="int" resultType="com.example.TeamProject.model.NoticeComment">
	    SELECT
	        COMMENT_NO,
	        NOTICE_NO,
	        USER_ID,
	        CONTENTS,
	        TO_CHAR(CDATETIME, 'YYYY-MM-DD HH24:MI') AS CDATETIME,
	        TO_CHAR(UDATETIME, 'YYYY-MM-DD HH24:MI') AS UDATETIME,
	        PARENT_COMMENT_NO
	    FROM
	        NOTICE_COMMENT
	    WHERE
	        COMMENT_NO = #{commentNo}
	</select>

 </mapper>