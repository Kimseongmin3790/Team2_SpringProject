<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.TeamProject.mapper.SellerMapper"> <!-- SellerMapper 인터페이스와 연결됩니다. -->

    <!-- SellerVO와 User 객체를 매핑하기 위한 resultMap -->
    <resultMap id="sellerWithUserResultMap" type="com.example.TeamProject.model.SellerVO">
        <id property="userId" column="USER_ID"/>
        <result property="businessName" column="BUSINESS_NAME"/>
        <result property="businessLi" column="BUSINESS_LI"/>
        <result property="verified" column="VERIFIED"/>
        <result property="businessNumber" column="BUSINESS_NUMBER"/>
        <result property="account" column="ACCOUNT"/>
        <result property="bankName" column="BANKNAME"/>
        <result property="lat" column="LAT"/>
        <result property="lng" column="LNG"/>

        <!-- 연관된 User 객체 매핑 -->
        <association property="user" javaType="com.example.TeamProject.model.User">
            <result property="name" column="USER_NAME"/>
            <result property="address" column="USER_ADDRESS"/>
        </association>
    </resultMap>

    <!-- 판매자 정보 가져오기 -->
    <select id="getSellerInfo" parameterType="String" resultMap="sellerWithUserResultMap">
        SELECT
            s.USER_ID,
            s.BUSINESS_NAME,
            s.BUSINESS_LI,
            s.VERIFIED,
            s.BUSINESS_NUMBER,
            s.ACCOUNT,
            s.BANKNAME,
            s.LAT,
            s.LNG,
            u.NAME AS USER_NAME,
            u.ADDRESS AS USER_ADDRESS
        FROM
            SELLER_INFO s
        JOIN
            USERS u ON s.USER_ID = u.USER_ID
        WHERE
            s.USER_ID = #{userId}
    </select>
    
    <!--농가정보수정-->
    <update id="updateSellerInfo" parameterType="com.example.TeamProject.model.SellerVO">
	    UPDATE SELLER_INFO
	    SET
	        BUSINESS_NAME = #{businessName} 
	    WHERE USER_ID = #{userId}
	</update>
	
	 <!-- 사용자 정보 수정 -->
	 <update id="updateUserInfo" parameterType="com.example.TeamProject.model.User">
	     UPDATE USERS
	     SET
	         NAME = #{name, jdbcType=VARCHAR},  
	         ADDRESS = #{address, jdbcType=VARCHAR}, 
	         UDATETIME = SYSDATE
	     WHERE USER_ID = #{userId}
	 </update>
	 
	<!-- 사용자 전화번호(USERS.PHONE) 업데이트 쿼리 -->
	<update id="updateUserPhone" parameterType="com.example.TeamProject.model.User">
	    UPDATE USERS
	    SET
	        PHONE = #{phone, jdbcType=VARCHAR},
	        UDATETIME = SYSDATE
	    WHERE USER_ID = #{userId}
	</update>
	
	<!-- 판매자 계좌 정보(SELLER_INFO.ACCOUNT, BANKNAME) 업데이트 쿼리 -->
	<update id="updateSellerAccountInfo" parameterType="com.example.TeamProject.model.SellerVO">
	    UPDATE SELLER_INFO
	    SET
	        ACCOUNT = #{account, jdbcType=VARCHAR},
	        BANKNAME = #{bankName, jdbcType=VARCHAR}
	    WHERE USER_ID = #{userId}
	</update>
	 
	 
	 

</mapper>